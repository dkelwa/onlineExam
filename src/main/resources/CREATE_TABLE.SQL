USE test;

DROP TABLE IF EXISTS ATTEMPT;
DROP TABLE IF EXISTS STUDENT;
DROP TABLE IF EXISTS CONTEST;
DROP TABLE IF EXISTS QUESTION;

CREATE TABLE IF NOT EXISTS CONTEST (
    CONTEST_ID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    INSTITUTE_ID INT NOT NULL UNIQUE KEY,
    INSTITUTE_NAME VARCHAR(100),
    CONTEST_DATE TIMESTAMP,
    BEGIN_TIME TIMESTAMP,
    END_TIME TIMESTAMP
)ENGINE=INNODB;

CREATE TABLE IF NOT EXISTS STUDENT (
    STUDENT_ID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    EMAILID  VARCHAR(50) UNIQUE KEY,
    PASSWORD VARCHAR(50),
    FNAME VARCHAR(50),
    LNAME VARCHAR(50),
    ADDRESS VARCHAR(50),
    MOBILE_PHONE INT(10),
    RESS_PHONE INT(10),
    INSTITUTE_ID INT,
    BRANCH VARCHAR(10),
    SEMESTER VARCHAR(5),
    FOREIGN KEY (INSTITUTE_ID) REFERENCES CONTEST(INSTITUTE_ID)
)ENGINE=INNODB;

CREATE TABLE IF NOT EXISTS QUESTION (
    QUESTION_ID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    QUESTION_TEXT VARCHAR(2000),
    MARKS INT,
    INPUT1 VARCHAR(2000),
    INPUT2 VARCHAR(2000),
    INPUT3 VARCHAR(2000),
    OUTPUT1 VARCHAR(2000),
    OUTPUT2 VARCHAR(2000),
    OUTPUT3 VARCHAR(2000)
)ENGINE=INNODB;

CREATE TABLE IF NOT EXISTS ATTEMPT (
    CONTEST_ID INT NOT NULL,
    QUESTION_ID INT NOT NULL,
    STUDENT_ID INT NOT NULL,
    PROGRAM_TEXT VARCHAR(2000),
    MARKS_OBT INT,
    TIME_TAKEN_SEC INT,
    PRIMARY KEY (CONTEST_ID, QUESTION_ID, STUDENT_ID),
    FOREIGN KEY (CONTEST_ID) REFERENCES CONTEST(CONTEST_ID),
    FOREIGN KEY (QUESTION_ID) REFERENCES QUESTION(QUESTION_ID),
    FOREIGN KEY (STUDENT_ID) REFERENCES STUDENT(STUDENT_ID)
)ENGINE=INNODB;
